(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))o(t);new MutationObserver(t=>{for(const e of t)if(e.type==="childList")for(const i of e.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function n(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?e.credentials="include":t.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function o(t){if(t.ep)return;t.ep=!0;const e=n(t);fetch(t.href,e)}})();const p="/edinburgh-bus-map/assets/edinburgh_map-BY0HG-s1.svg";async function h(r){const s=await fetch(r).then(o=>o.text());return new DOMParser().parseFromString(s,"image/svg+xml").documentElement}let a=null;const c={bottom:55.85361336337268,left:-3.5110821302941106,right:-3.018069115777291,top:56.0000222};async function g(){a=await h(p),a.setAttribute("id","base-map"),document.getElementById("main").appendChild(a)}const b="https://tfe-opendata.com/api/v1";function y(){return fetch(`${b}/vehicle_locations`).then(r=>r.json())}function w(r,s){const n=document.getElementById("base-map");if(!n)throw new Error("SVG element with id 'base-map' not found");const o=n.getAttribute("viewBox");if(!o)throw new Error("SVG element has no viewBox attribute");const[t,e,i,u]=o.split(" ").map(Number),l=(s-c.left)/(c.right-c.left),d=(c.top-r)/(c.top-c.bottom),m=t+l*i,f=e+d*u;return{x:m,y:f}}function v(r,s){const n=document.createElementNS("http://www.w3.org/2000/svg","circle");return n.setAttribute("r","2"),n.setAttribute("cx",r),n.setAttribute("cy",s),n.setAttribute("fill","red"),n.setAttribute("stroke","grey"),n.setAttribute("stroke-width","1"),n}async function E(){const r=document.getElementById("base-map");if(!r){console.error("SVG map not loaded yet");return}(await y()).vehicles.map(({latitude:o,longitude:t})=>{const{x:e,y:i}=w(o,t);return v(e,i)}).forEach(o=>r.appendChild(o))}async function x(){await g(),E()}x();
